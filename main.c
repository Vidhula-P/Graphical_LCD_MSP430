#include <msp430.h>

/* Chip select - P8.4
 * Reset - P3.4
 * AO (Register select) - P3.5
 * SCL - P8.1
 * SI - P3.6 */

void RES_state (unsigned int rs);
void CS_state (unsigned int cs);
void AO_state (unsigned int ao);
void SCL_state(unsigned int sck);
void SI_state(unsigned int sda);
void GLCD_GoTo (unsigned int col_addr, unsigned int pag_addr);
void GLCD_writeCommand (unsigned char cmd);
void GLCD_writeData (unsigned char data);
void GLCD_display(unsigned int col,unsigned int page,unsigned char *buf);

static const unsigned char input[] = { //generated using "GLCD Font Creator"
                                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char
                                        0x00, 0xBE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char !
                                        0x03, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char "
                                        0x00, 0x20, 0xE4, 0x3C, 0xE7, 0x3C, 0x27, 0x04,  // Code for char #
                                        0x00, 0x24, 0x2A, 0x7F, 0x2A, 0x12, 0x00, 0x00,  // Code for char $
                                        0x02, 0x05, 0xE2, 0x10, 0x08, 0x47, 0xA0, 0x40,  // Code for char %
                                        0x76, 0x89, 0x89, 0x96, 0x60, 0x58, 0x80, 0x00,  // Code for char &
                                        0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char '
                                        0x00, 0x00, 0x7C, 0x82, 0x00, 0x00, 0x00, 0x00,  // Code for char (
                                        0x00, 0x82, 0x7C, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char )
                                        0x00, 0x22, 0x14, 0x7F, 0x14, 0x22, 0x00, 0x00,  // Code for char *
                                        0x00, 0x10, 0x10, 0x10, 0xFE, 0x10, 0x10, 0x10,  // Code for char +
                                        0x00, 0x80, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char ,
                                        0x00, 0x00, 0x10, 0x10, 0x10, 0x00, 0x00, 0x00,  // Code for char -
                                        0x00, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char .
                                        0x00, 0x80, 0x7C, 0x02, 0x00, 0x00, 0x00, 0x00,  // Code for char /
                                        0x00, 0x7E, 0x81, 0x81, 0x81, 0x7E, 0x00, 0x00,  // Code for char 0
                                        0x00, 0x82, 0xFE, 0x80, 0x00, 0x00, 0x00, 0x00,  // Code for char 1
                                        0xC2, 0xA1, 0x91, 0x89, 0x86, 0x00, 0x00, 0x00,  // Code for char 2
                                        0x42, 0x81, 0x89, 0x89, 0x76, 0x00, 0x00, 0x00,  // Code for char 3
                                        0x18, 0x14, 0x12, 0xFF, 0x10, 0x00, 0x00, 0x00,  // Code for char 4
                                        0x00, 0x00, 0x4F, 0x89, 0x89, 0x89, 0x71, 0x00,  // Code for char 5
                                        0x7E, 0x89, 0x89, 0x89, 0x70, 0x00, 0x00, 0x00,  // Code for char 6
                                        0x00, 0x00, 0xC1, 0x31, 0x0D, 0x03, 0x00, 0x00,  // Code for char 7
                                        0x00, 0x00, 0x76, 0x89, 0x89, 0x89, 0x76, 0x00,  // Code for char 8
                                        0x00, 0x0E, 0x91, 0x91, 0x51, 0x3E, 0x00, 0x00,  // Code for char 9
                                        0x00, 0x00, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char :
                                        0x00, 0x80, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char ;
                                        0x00, 0x10, 0x28, 0x28, 0x44, 0x44, 0x82, 0x00,  // Code for char <
                                        0x28, 0x28, 0x28, 0x28, 0x28, 0x28, 0x28, 0x00,  // Code for char =
                                        0x00, 0x82, 0x44, 0x44, 0x28, 0x28, 0x10, 0x00,  // Code for char >
                                        0x00, 0x00, 0x01, 0xB1, 0x09, 0x06, 0x00, 0x00,  // Code for char ?
                                        0x7E, 0x81, 0x99, 0xA5, 0xA5, 0xB9, 0x21, 0x3E,  // Code for char @
                                        0x00, 0xE0, 0x3C, 0x22, 0x22, 0x3C, 0xE0, 0x00,  // Code for char A
                                        0x00, 0x00, 0xFF, 0x89, 0x89, 0x89, 0x76, 0x00,  // Code for char B
                                        0x3C, 0x42, 0x81, 0x81, 0x81, 0x81, 0x00, 0x00,  // Code for char C
                                        0xFF, 0x81, 0x81, 0x81, 0x42, 0x3C, 0x00, 0x00,  // Code for char D
                                        0xFF, 0x89, 0x89, 0x89, 0x81, 0x00, 0x00, 0x00,  // Code for char E
                                        0x00, 0xFF, 0x09, 0x09, 0x09, 0x09, 0x01, 0x00,  // Code for char F
                                        0x00, 0x3C, 0x42, 0x81, 0x91, 0x91, 0xF1, 0x00,  // Code for char G
                                        0x00, 0xFF, 0x08, 0x08, 0x08, 0x08, 0xFF, 0x00,  // Code for char H
                                        0x00, 0x00, 0x81, 0xFF, 0x81, 0x00, 0x00, 0x00,  // Code for char I
                                        0x00, 0x80, 0x81, 0x81, 0x7F, 0x01, 0x00, 0x00,  // Code for char J
                                        0x00, 0x00, 0xFF, 0x18, 0x24, 0x42, 0x81, 0x00,  // Code for char K
                                        0x00, 0x00, 0xFF, 0x80, 0x80, 0x80, 0x00, 0x00,  // Code for char L
                                        0x00, 0xFF, 0x02, 0x0C, 0x30, 0x0C, 0x02, 0xFF,  // Code for char M
                                        0xFF, 0x02, 0x0C, 0x30, 0xC0, 0xFF, 0x00, 0x00,  // Code for char N
                                        0x3C, 0x42, 0x81, 0x81, 0x81, 0x42, 0x3C, 0x00,  // Code for char O
                                        0xFE, 0x11, 0x11, 0x11, 0x0E, 0x00, 0x00, 0x00,  // Code for char P
                                        0x1C, 0x22, 0x41, 0x51, 0x61, 0x62, 0x9C, 0x00,  // Code for char Q
                                        0x00, 0xFF, 0x11, 0x11, 0x31, 0x4E, 0x80, 0x00,  // Code for char R
                                        0x00, 0x86, 0x89, 0x89, 0x89, 0x71, 0x00, 0x00,  // Code for char S
                                        0x00, 0x01, 0x01, 0xFF, 0x01, 0x01, 0x00, 0x00,  // Code for char T
                                        0x00, 0x7F, 0x80, 0x80, 0x80, 0x80, 0x7F, 0x00,  // Code for char U
                                        0x00, 0x07, 0x38, 0xC0, 0x38, 0x07, 0x00, 0x00,  // Code for char V
                                        0x00, 0x3F, 0xC0, 0x38, 0x06, 0x38, 0xC0, 0x3F,  // Code for char W
                                        0x00, 0xC3, 0x24, 0x18, 0x24, 0xC3, 0x00, 0x00,  // Code for char X
                                        0x00, 0x03, 0x0C, 0xF0, 0x0C, 0x03, 0x00, 0x00,  // Code for char Y
                                        0x00, 0xC1, 0xA1, 0x99, 0x85, 0x83, 0x00, 0x00,  // Code for char Z
                                        0xFF, 0x81, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char [
                                        0x00, 0x02, 0x7C, 0x80, 0x00, 0x00, 0x00, 0x00,  // Code for char BackSlash
                                        0x00, 0x81, 0x81, 0xFF, 0x00, 0x00, 0x00, 0x00,  // Code for char ]
                                        0x08, 0x04, 0x02, 0x01, 0x02, 0x04, 0x08, 0x00,  // Code for char ^
                                        0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00,  // Code for char _
                                        0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char `
                                        0x00, 0x60, 0x94, 0x94, 0x94, 0xF8, 0x00, 0x00,  // Code for char a
                                        0x00, 0xFF, 0x84, 0x84, 0x84, 0x78, 0x00, 0x00,  // Code for char b
                                        0x00, 0x78, 0x84, 0x84, 0x84, 0x00, 0x00, 0x00,  // Code for char c
                                        0x00, 0x78, 0x84, 0x84, 0x84, 0xFF, 0x00, 0x00,  // Code for char d
                                        0x00, 0x78, 0x94, 0x94, 0x94, 0x58, 0x00, 0x00,  // Code for char e
                                        0x00, 0x80, 0x7C, 0x12, 0x11, 0x01, 0x00, 0x00,  // Code for char f
                                        0x00, 0x4C, 0x92, 0x92, 0xFE, 0x00, 0x00, 0x00,  // Code for char g
                                        0xFF, 0x04, 0x04, 0x04, 0xF8, 0x00, 0x00, 0x00,  // Code for char h
                                        0x00, 0x00, 0x00, 0xF9, 0x00, 0x00, 0x00, 0x00,  // Code for char i
                                        0x00, 0x40, 0x84, 0x7D, 0x00, 0x00, 0x00, 0x00,  // Code for char j
                                        0xFF, 0x10, 0x28, 0x44, 0x80, 0x00, 0x00, 0x00,  // Code for char k
                                        0x00, 0x00, 0xFF, 0x80, 0x40, 0x00, 0x00, 0x00,  // Code for char l
                                        0x00, 0xFC, 0x04, 0x04, 0xF8, 0x04, 0x04, 0xF8,  // Code for char m
                                        0x00, 0xFC, 0x04, 0x04, 0x04, 0xF8, 0x00, 0x00,  // Code for char n
                                        0x00, 0x78, 0x84, 0x84, 0x84, 0x78, 0x00, 0x00,  // Code for char o
                                        0x00, 0x00, 0xFC, 0x24, 0x24, 0x18, 0x00, 0x00,  // Code for char p
                                        0x00, 0x0C, 0x12, 0x12, 0x7C, 0x80, 0x40, 0x00,  // Code for char q
                                        0x00, 0x00, 0xFC, 0x08, 0x04, 0x08, 0x00, 0x00,  // Code for char r
                                        0x00, 0x00, 0x98, 0x94, 0xA4, 0x64, 0x00, 0x00,  // Code for char s
                                        0x00, 0x00, 0x7F, 0x84, 0x84, 0x00, 0x00, 0x00,  // Code for char t
                                        0x00, 0x7C, 0x80, 0x80, 0x80, 0xFC, 0x80, 0x00,  // Code for char u
                                        0x00, 0x0C, 0x30, 0xC0, 0x30, 0x0C, 0x00, 0x00,  // Code for char v
                                        0x3C, 0xC0, 0x30, 0x0C, 0x30, 0xC0, 0x3C, 0x00,  // Code for char w
                                        0x84, 0x48, 0x30, 0x48, 0x84, 0x00, 0x00, 0x00,  // Code for char x
                                        0x00, 0x83, 0x4C, 0x30, 0x0C, 0x02, 0x01, 0x00,  // Code for char y
                                        0x00, 0x00, 0xC4, 0xA4, 0x94, 0x8C, 0x00, 0x00,  // Code for char z
                                        0x00, 0x10, 0x10, 0x6C, 0x82, 0x82, 0x00, 0x00,  // Code for char {
                                        0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char |
                                        0x00, 0x82, 0x82, 0x6C, 0x10, 0x10, 0x00, 0x00,  // Code for char }
                                        0x30, 0x08, 0x08, 0x10, 0x20, 0x20, 0x18, 0x00,  // Code for char ~
                                       };

void GLCD_initPorts(void)
{
    P3SEL &= 0xDF; //AO --> P3.5
    P3DIR |= 0x20;
    AO_state(1);

    P3SEL &= 0xEF; //RES ---> 3.4
    P3DIR |= 0x10;
    RES_state(1);

    P8SEL &= 0xEF; //CS --> P8.4
    P8DIR |= 0x10;
    CS_state(1);

    P8SEL &= 0xFD; //SCL --> P8.1
    P8DIR |= 0x02;
    SCL_state(1);

    P3SEL &= 0xBF; // SI --> P3.6
    P3DIR |= 0x40;
    SI_state(1);
}
void RES_state (unsigned int rs)
{
    if (rs==1)
        P3OUT |= 0x10; //(P3.4)
    else if (rs==0)
        P3OUT &= 0xEF;
}

void CS_state (unsigned int cs) //P8.4
{
    if (cs==1)
        P8OUT |= 0x10; //CS_state enable
    else
        P8OUT &= 0xEF; //CS_state disable
}
void AO_state (unsigned int ao)
{
    if (ao==1)
        P3OUT |= 0x20; //(P3.5)
    else
        P3OUT &= 0xDF;
}
void SCL_state(unsigned int sck) //P8.1
{
    if (sck==1)
        P8OUT |= 0x02;
    else
        P8OUT &= 0xFD;
}
void SI_state(unsigned int si)
{
    if (si==1)
        P3OUT |= 0x40; //(P3.6)
    else
        P3OUT &= 0xBF;
}
void GLCD_init(void)
{
    //12 o'clock (Top View)
    GLCD_writeCommand(0x40); // (2)  display start line 0
    GLCD_writeCommand(0xA0); // (8)  ADC normal
    GLCD_writeCommand(0xC8); // (15) COM63~COM0
    GLCD_writeCommand(0xA6); // (9)  display NORMAL
    GLCD_writeCommand(0xA2); // (11) LCD bias set 1/9 (Duty 1/65)
    GLCD_writeCommand(0x2F); // (16) Booster, regulator & follower on
    GLCD_writeCommand(0xF8); // (20) Booster radio set 4x
    GLCD_writeCommand(0x00); // (20) Booster radio set 4x
    GLCD_writeCommand(0x27); // (17) contrast set
    GLCD_writeCommand(0x81); // (18) Electronic volume mode set
    GLCD_writeCommand(0x16); // (18) Electronic volume register set <-----
    GLCD_writeCommand(0xAC); // (19) static indicator off
    GLCD_writeCommand(0x00); // (19) static indicator mode
    GLCD_writeCommand(0xAF); // (1)  display ON
}
void GLCD_writeCommand (unsigned char cmd)
{
    CS_state(0);
    __no_operation();
    AO_state(0);
    __no_operation();
    signed int i;
    for (i = 8; i>0; i--)
    {
        SCL_state(0);
        __no_operation();
        //MSB first
        if (cmd & 0x80)
            SI_state(1);
        else
            SI_state(0);

        cmd = cmd <<1;
        SCL_state(1);
        __no_operation();
    }
    CS_state(1);
    __no_operation();
    AO_state(1);
}
void GLCD_writeData(unsigned char data)
{
    CS_state(0);
    __no_operation();
    AO_state(1);
    __no_operation();

    signed int i;
    for (i =8; i>0; i--)
    {
        SCL_state(0);
        __no_operation();
        //MSB first
        if (data & 0x80)
            SI_state(1);
        else
            SI_state(0);
        data = data <<1;
        SCL_state(1);
        __no_operation();
    }
    CS_state(1);
    __no_operation();
    AO_state(0);
}

void GLCD_reset(void)
{
    volatile int k;
    AO_state(1);
    RES_state(1);
    CS_state(0);
    __no_operation();

    RES_state(0);
    for(k=20000;k>0;k--)
       __no_operation();

    RES_state(1);
    for(k=2000;k>0;k--)
       __no_operation();
}

void GLCD_clear_screen(void)
{
    int i = 0, q = 0;
    for (i = 0; i<8; i++) //page length = 8
    {
        for (q = 0; q<132; q++) //column 0 to 131
        {
            GLCD_GoTo(q,i);
            GLCD_writeData(0);
        }
    }
}
void GLCD_GoTo (unsigned int col_addr, unsigned int pag_addr)
{
    GLCD_writeCommand(0x10 | (col_addr>>4)) ; //first half nibble
    GLCD_writeCommand(0x00 | (col_addr&0x0F)) ; //second half nibble
    GLCD_writeCommand(0xB0 | pag_addr);
}
void GLCD_display(unsigned int col,unsigned int page,unsigned char *buf)
{
    unsigned int yaddr, xaddr, i, n, pp, num, k;
    yaddr = col;
    xaddr = page;
    i=0;
    while(buf[i]!='\0')
    {
        n = buf[i] - 32;
        pp = 8*n;
        num = 8*(n+1);
        GLCD_GoTo(yaddr,xaddr);
        for(k=pp;k<num;k++)
        {
            GLCD_writeData(input[k]);
            yaddr++;
        }
        i++;
    }
}

/**
 * main.c
 */
int main(void)
{
    WDTCTL = WDTPW + WDTHOLD;   // stop watchdog timer
    GLCD_initPorts();
    GLCD_reset();
    GLCD_init();
    GLCD_clear_screen();
    while(1)
    {
        GLCD_display(0x04,0x00, "Yellow#@(45)"); //Top view starts from Column 4 Page 0
    }
}
